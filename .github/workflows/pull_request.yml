name: Deploy Jenkins to CI-CD Server
on: [push]
jobs:
  deploy:
    name: Deploy
    runs-on: ubuntu-latest
    steps:
    - name: Pull and run Jenkins through ssh
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.SERVER_HOST_IP }}
        username: ${{ secrets.SERVER_USERNAME }}
        password: ${{ secrets.SERVER_PASSWORD }}
        port: 22
        script: |
          docker pull islasgeci/jenkins:latest
          docker run \
          --detach \
          --name jenkins \
          --publish 50000:50000 \
          --publish 8080:8080 \
          --rm \
          --volume /var/run/docker.sock:/var/run/docker.sock \
          --volume ${HOME}/.vault/.secrets:/.vault/.secrets \
          --volume jenkins_home:/var/jenkins_home \
          islasgeci/jenkins:latest